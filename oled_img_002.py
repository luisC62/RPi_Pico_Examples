from machine import Pin, I2C
from ssd1306 import SSD1306_I2C
import utime
import framebuf

# Configure button hardware
onboard_led = Pin(25, Pin.OUT)
button = machine.Pin(14, machine.Pin.IN, machine.Pin.PULL_DOWN)

# Configure i2c and oled display
i2c=I2C(0,sda=Pin(0), scl=Pin(1), freq=400000)
oled = SSD1306_I2C(128, 64, i2c)

# Setting images
face1 = bytearray(b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0e\x00\x00\x00\xc0\x00\x00\x00\x1f\x80\x00\x01\xf0\x00\x00\x00?\xc0\x00\x03\xf8\x00\x00\x00?\xc0\x00\x07\xf8\x00\x00\x00\x7f\xe0\x00\x0f\xfc\x00\x00\x00\x7f\xe0\x00\x0f\xfc\x00\x00\x00\x7f\xe0\x00\x0f\xfc\x00\x00\x00\x7f\xe0\x00\x0f\xfc\x00\x00\x00\x7f\xe0\x00\x0f\xfc\x00\x00\x00?\xc0\x00\x07\xf8\x00\x00\x00?\x80\x00\x03\xf8\x00\x00\x00\x1f\x80\x00\x01\xf0\x00\x00\x00\x06\x00\x00\x00\xe0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x04\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00@\x00\x00\x00\x03\x00\x00\x01\x80\x00\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00@\x00\x06\x00\x00\x00\x00\x00 \x00\x08\x00\x00\x00\x00\x00\x10\x000\x00\x00\x00\x00\x00\x08\x00@\x00\x00\x00\x00\x00\x06\x00\x80\x00\x00\x00\x00\x00\x01\x83\x00\x00\x00\x00\x00\x00\x00|\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00')
face2 = bytearray(b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0e\x00\x00\x00\xc0\x00\x00\x00\x1f\x80\x00\x01\xf0\x00\x00\x00?\xc0\x00\x03\xf8\x00\x00\x00?\xc0\x00\x07\xf8\x00\x00\x00\x7f\xe0\x00\x0f\xfc\x00\x00\x00\x7f\xe0\x00\x0f\xfc\x00\x00\x00\x7f\xe0\x00\x0f\xfc\x00\x00\x00\x7f\xe0\x00\x0f\xfc\x00\x00\x00\x7f\xe0\x00\x0f\xfc\x00\x00\x00?\xc0\x00\x07\xf8\x00\x00\x00?\x80\x00\x03\xf8\x00\x00\x00\x1f\x80\x00\x01\xf0\x00\x00\x00\x06\x00\x00\x00\xe0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\xff\xff\xff\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00')
face3 = bytearray(b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x06\x00\x00\x00@\x00\x00\x00\x08\x00\x00\x000\x00\x00\x00\x10\x00\x00\x00\x0c\x00\x00\x00`\x00\x00\x00\x03\x00\x00\x01\x80\x00\x00\x00\x00\xc0\x00\x02\x00\x00\x00\x00\x0e0\x00\x0c\xc0\x00\x00\x00\x1f\x88\x001\xf0\x00\x00\x00?\xc6\x00C\xf8\x00\x00\x00?\xc0\x00\x87\xf8\x00\x00\x00\x7f\xe0\x00\x0f\xfc\x00\x00\x00\x7f\xe0\x00\x0f\xfc\x00\x00\x00\x7f\xe0\x00\x0f\xfc\x00\x00\x00\x7f\xe0\x00\x0f\xfc\x00\x00\x00\x7f\xe0\x00\x0f\xfc\x00\x00\x00?\xc0\x00\x07\xf8\x00\x00\x00?\x80\x00\x03\xf8\x00\x00\x00\x1f\x80\x00\x01\xf0\x00\x00\x00\x06\x00\x00\x00\xe0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00>\x00\x00\x00\x00\x00\x00\x01\xc1\xc0\x00\x00\x00\x00\x00\x02\x00 \x00\x00\x00\x00\x00\x0c\x00\x18\x00\x00\x00\x00\x00\x10\x00\x06\x00\x00\x00\x00\x00`\x00\x01\x00\x00\x00\x00\x00\x80\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00')
face4 = bytearray(b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x06\x00\x00\x00@\x00\x00\x00\x08\x00\x00\x000\x00\x00\x00\x10\x00\x00\x00\x0c\x00\x00\x00`\x00\x00\x00\x03\x00\x00\x01\x80\x00\x00\x00\x00\xc0\x00\x02\x00\x00\x00\x00\x0e0\x00\x0c\xc0\x00\x00\x00\x1f\x88\x001\xf0\x00\x00\x00?\xc6\x00C\xf8\x00\x00\x00?\xc0\x00\x87\xf8\x00\x00\x00\x7f\xe0\x00\x0f\xfc\x00\x00\x00\x7f\xe0\x00\x0f\xfc\x00\x00\x00\x7f\xe0\x00\x0f\xfc\x00\x00\x00\x7f\xe0\x00\x0f\xfc\x00\x00\x00\x7f\xe0\x00\x0f\xfc\x00\x00\x00?\xc0\x00\x07\xf8\x00\x00\x00?\x80\x00\x03\xf8\x00\x00\x00\x1f\x80\x00\x01\xf0\x00\x00\x00\x06\x00\x00\x00\xe0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xff\xc0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00')
face5 = bytearray(b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x06\x00\x00\x00@\x00\x00\x00\x08\x00\x00\x000\x00\x00\x00\x10\x00\x00\x00\x0c\x00\x00\x00`\x00\x00\x00\x03\x00\x00\x01\x80\x00\x00\x00\x00\xc0\x00\x02\x00\x00\x00\x00\x000\x00\x0c\x00\x00\x00\x00\x00\x08\x000\x00\x00\x00\x00\x00\x06\x00@\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\xf0\x00\x0f\xf0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x18\x00\x00\x00\x00\x00\x00\x00<\x00\x00\x00\x00\x00\x00\x00<\x00\x00\x00\x00\x00\x00\x00|\x00\x00\x00\x00\x00\x00\x00|\x00\x00\x00\x00\x00\x00\x00|\x00\x00\x00\x00\x00\x00\x00|\x00\x00\x00\x00\x00\x00\x00|\x00\x00\x00\x00\x00\x00\x00|\x00\x00\x00\x00\x00\x00\x00|\x00\x00\x00\x00\x00\x00\x00<\x00\x00\x00\x00\x00\x00\x00<\x00\x00\x00\x00\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00')

# Set initial conditions
onboard_led.high()
state = 0
print("Estado: ", state)
fb = framebuf.FrameBuffer(face1, 64, 64, framebuf.MONO_HLSB)
oled.fill(0)
oled.blit(fb,32,0)
oled.show()

# attach the interrupt to the buttonPin
def alert(pin):
    #avoid rebounds
    global state
    utime.sleep(0.25)
    if button.value() == 1:
        if state == 0:
            state = 1
            print("Estado: ", state)
            fb = framebuf.FrameBuffer(face2, 64, 64, framebuf.MONO_HLSB)
            oled.fill(0)
            oled.blit(fb,32,0)
            oled.show()
        elif state == 1:
            state = 2
            print("Estado: ", state)
            fb = framebuf.FrameBuffer(face3, 64, 64, framebuf.MONO_HLSB)
            oled.fill(0)
            oled.blit(fb,32,0)
            oled.show()
        elif state == 2:
            state = 3
            print("Estado: ", state)
            fb = framebuf.FrameBuffer(face5, 64, 64, framebuf.MONO_HLSB)
            oled.fill(0)
            oled.blit(fb,32,0)
            oled.show()
        elif state == 3:
            state = 0
            print("Estado: ", state)
            fb = framebuf.FrameBuffer(face1, 64, 64, framebuf.MONO_HLSB)
            oled.fill(0)
            oled.blit(fb,32,0)
            oled.show()
            
button.irq(trigger = Pin.IRQ_RISING , handler = alert)

while True:
    if state==0:
        onboard_led.high()
    else:
        onboard_led.low()
    if state==3:
        utime.sleep(0.2)
        fb = framebuf.FrameBuffer(face4, 64, 64, framebuf.MONO_HLSB)
        oled.fill(0)
        oled.blit(fb,32,0)
        oled.show()
        utime.sleep(0.2)
        fb = framebuf.FrameBuffer(face5, 64, 64, framebuf.MONO_HLSB)
        oled.fill(0)
        oled.blit(fb,32,0)
        oled.show()
        utime.sleep(0.2)
    elif state==0:
        fb = framebuf.FrameBuffer(face1, 64, 64, framebuf.MONO_HLSB)
        oled.fill(0)
        oled.blit(fb,32,0)
        oled.show()
        
        